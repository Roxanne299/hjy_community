<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.zgy.hjy_community.system.mapper.SysUserMapper">
    <resultMap id="sys_dept" type="sysDept">
        <id property="deptId" column="dept_id"></id>
        <result property="parentId" column="parent_id"></result>
        <result property="ancestors" column="ancestors"></result>
        <result property="deptName" column="dept_name"></result>
        <result property="orderNum" column="order_num"></result>
        <result property="leader" column="leader"></result>
        <result property="phone" column="phone"></result>
        <result property="email" column="email"></result>
        <result property="status" column="status"></result>
        <result property="delFlag" column="del_flag"></result>
        <result property="parentId" column="parent_id"></result>
    </resultMap>
    <resultMap id="sys_roles" type="sysRole">
        <id property="roleId" column="role_id"></id>
        <result property="roleName" column="role_name"></result>
        <result property="roleKey" column="role_key"></result>
        <result property="roleSort" column="role_sort"></result>
        <result property="dataScope" column="data_scope"></result>
        <result property="menuCheckStrictly" column="menu_check_strictly"></result>
        <result property="deptCheckStrictly" column="dept_check_strictly"></result>
        <result property="status" column="status"></result>
        <result property="delFlag" column="del_flag"></result>
    </resultMap>
    <resultMap id="sys_user" type="SysUser" >
        <id property="userId" column="user_id"></id>
        <result property="deptId" column="dept_id"></result>
        <result property="userName" column="user_name"></result>
        <result property="nickName" column="nick_name"></result>
        <result property="email" column="email"></result>
        <result property="phonenumber" column="phonenumber"></result>
        <result property="sex" column="sex"></result>
        <result property="avatar" column="avatar"></result>
        <result property="password" column="password"></result>
        <result property="status" column="status"></result>
        <result property="delFlag" column="del_flag"></result>
        <result property="loginIp" column="login_ip"></result>
        <result property="loginDate" column="login_date"></result>
        <association property="dept" javaType="sysDept" resultMap="sys_dept"></association>
        <collection property="roles" javaType="java.util.List" resultMap="sys_roles"></collection>
    </resultMap>
    <select id="getUserByName"  resultMap="sys_user">
        SELECT su.user_id, su.dept_id , su.user_name,su.nick_name,su.email,su.phonenumber,su.sex,su.avatar,su.password,su.status,su.del_flag,su.login_ip,su.login_date,
               sd.dept_id,sd.parent_id,sd.ancestors,sd.dept_name,sd.order_num,sd.leader,sd.phone,sd.email,sd.status,sd.del_flag,sd.parent_id,
               sr.role_id,sr.role_name,sr.role_key,sr.role_sort,sr.data_scope,sr.menu_check_strictly,sr.dept_check_strictly,sr.status,sr.del_flag
        from sys_user as su
            LEFT JOIN sys_user_role as sur ON su.user_id = sur.user_id
            LEFT JOIN sys_role as sr ON sur.role_id = sr.role_id
            LEFT JOIN sys_dept as sd ON sd.dept_id = su.dept_id
        WHERE sr.del_flag = 0 AND su.status = '0' AND su.del_flag = 0 AND su.user_name = #{userName}

    </select>
</mapper>